<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Team Shroom Shiny Pages</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style/base.css">
  <link rel="stylesheet" href="style/layout.css">
  <link rel="stylesheet" href="style/cards.css">
  <link rel="stylesheet" href="style/buttons.css">
  <link rel="stylesheet" href="style/search.css">
  <link rel="stylesheet" href="style/tooltip.css">
  <link rel="stylesheet" href="style/darkmode.css">
  <link rel="stylesheet" href="style/donators.css">
  <link rel="icon" href="data:,">
</head>
<body>
  <div class="nav">
    <a href="#showcase" id="nav-showcase">Shiny Showcase</a>
    <a href="#hitlist" id="nav-hitlist">Shiny Pokedex</a>
    <a href="#shinyweekly" id="nav-shinyweekly">Shiny Weekly</a>
    <a href="#donators" id="nav-donators">Donators</a>
  </div>
  <button id="darkmode-toggle" style="position: absolute; top: 1rem; right: 1.5rem; z-index: 1000; background: var(--card); color: var(--accent); border: 2px solid var(--accent); border-radius: 8px; font-family: 'Press Start 2P', monospace; font-size: 1em; padding: 0.4em 1em; cursor: pointer; box-shadow: 0 2px 10px #000a; transition: background 0.2s, color 0.2s;">
    🌙 Dark Mode
  </button>
  <div id="page-content"></div>

  <!-- 1. LOAD POKEMON FAMILIES JSON, THEN RUN pokemondatabuilder.js -->
  <script>
  window.pokemonFamiliesData = null;
  function loadPokemonFamiliesAndBuilder() {
    fetch('data/pokemonfamilies.json')
      .then(r => r.json())
      .then(data => {
        window.pokemonFamiliesData = data;
        // Dynamically load the builder after JSON is ready
        var script = document.createElement('script');
        script.src = 'pokemondatabuilder.js';
        script.onload = function() {
          // After builder, load all other scripts
          var scripts = [
            "unifiedcard.js",
            "showcase.js",
            "shinydexsearch.js",
            "donators.js"
          ];
          var idx = 0;
          function loadNext() {
            if (idx < scripts.length) {
              var s = document.createElement('script');
              s.src = scripts[idx++];
              s.onload = loadNext;
              document.body.appendChild(s);
            } else {
              // Load donations.json for donators, then assign tiers
              fetch('data/donations.json').then(r=>r.json()).then(d=>{
                window.donations = d;
                if (window.teamShowcase && window.assignDonatorTiersToTeam) window.assignDonatorTiersToTeam();
              });
              // Also: Build shinyDex from the loaded families JSON
              if (window.buildShinyDexFromFamilies) window.buildShinyDexFromFamilies();
            }
          }
          loadNext();
        };
        document.body.appendChild(script);
      });
  }
  loadPokemonFamiliesAndBuilder();
</script>

  <!-- PAGE ROUTING & DARK MODE (these can be inline since they don't depend on Pokémon data) -->
  <script>
    // Routing: supports #showcase, #showcase-<member>, #hitlist, #shinyweekly, #donators
    function renderPage() {
      let hash = window.location.hash.replace("#", "");
      // Wait for teamShowcase/teamMembers for showcase-related pages
      if (
        (hash.startsWith("showcase") || hash === "" || hash.startsWith("showcase-"))
        && (!window.teamMembers || !window.teamShowcase)
      ) {
        setTimeout(renderPage, 50);
        return;
      }

      document.querySelectorAll('.nav a').forEach(a => {
        let navId = a.getAttribute('href').replace('#','');
        let active = false;
        if (hash.startsWith(navId)) active = true;
        // For default page (no hash), activate showcase
        if (!hash && navId === 'showcase') active = true;
        a.classList.toggle('active', active);
      });

      const content = document.getElementById('page-content');
      if (hash.startsWith("showcase-")) {
        // Split hash for name and sort
        const [namePart, queryPart] = hash.replace("showcase-", "").split("?");
        const memberName = namePart;
        let sortMode = "alphabetical";
        if (queryPart) {
          const m = queryPart.match(/sort=(\w+)/);
          if (m) sortMode = m[1];
        }
        const member = window.teamMembers && teamMembers.find(m => m.name === memberName);
        if (member) {
          window.renderMemberShowcase(member, sortMode);
        } else {
          content.innerHTML = "<h1>Member not found.</h1>";
        }
      } else if (hash.startsWith("showcase") || hash === "") {
        // Also check for sort mode in hash
        let sortMode = "alphabetical";
        const m = window.location.hash.match(/sort=(\w+)/);
        if (m) sortMode = m[1];
        content.innerHTML = `
          <div class="showcase-search-controls"></div>
          <div id="showcase-gallery-container"></div>
        `;
        if (window.setupShowcaseSearchAndSort && window.teamMembers && window.renderShowcaseGallery) {
          window.setupShowcaseSearchAndSort(window.teamMembers, window.renderShowcaseGallery, sortMode);
        }
      } else if (hash === "hitlist") {
        content.innerHTML = `
          <div id='shiny-dex-container'></div>
        `;
        setTimeout(() => {
          if (window.renderShinyDex && window.shinyDex) {
            window.renderShinyDex(window.shinyDex);
            setTimeout(() => {
              if (typeof window.setupShinyDexHitlistSearch === 'function') {
                window.setupShinyDexHitlistSearch(window.shinyDex, window.teamShowcase);
              }
            }, 0);
          }
        }, 0);
      } else if (hash === "shinyweekly") {
        content.innerHTML = `
          <div style='font-size:1.4em; margin:2em 0; color:var(--accent); text-align:center;'>soon-to-be</div>
        `;
      } else if (hash === "donators") {
        if (window.renderDonatorsWhenReady) window.renderDonatorsWhenReady();
      } else {
        content.innerHTML = "<h1>Page not found.</h1>";
      }
    }
    window.addEventListener('hashchange', renderPage);
    document.addEventListener('DOMContentLoaded', renderPage);
  </script>
  <script>
    // Dark mode toggle logic
    const btn = document.getElementById('darkmode-toggle');
    function setDarkMode(on) {
      document.body.classList.toggle('darkmode', on);
      btn.textContent = on ? '☀️ Light Mode' : '🌙 Dark Mode';
      localStorage.setItem('darkmode', on ? '1' : '0');
    }
    btn.onclick = () => setDarkMode(!document.body.classList.contains('darkmode'));
    // On load: check localStorage or system preference
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    setDarkMode(localStorage.getItem('darkmode') === '1' || (!localStorage.getItem('darkmode') && prefersDark));
  </script>
</body>
</html>
