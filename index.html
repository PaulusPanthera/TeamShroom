<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Team Shroom Shiny Pages</title>
  <!-- Retro Pixel Font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style/base.css">
  <link rel="stylesheet" href="style/layout.css">
  <link rel="stylesheet" href="style/cards.css">
  <link rel="stylesheet" href="style/buttons.css">
  <link rel="stylesheet" href="style/search.css">
  <link rel="stylesheet" href="style/tooltip.css">
  <link rel="stylesheet" href="style/darkmode.css">
  <link rel="stylesheet" href="style/donators.css">
  <link rel="icon" href="data:,">
</head>
<body>
  <div class="nav">
    <a href="#showcase" id="nav-showcase">Shiny Showcase</a>
    <a href="#hitlist" id="nav-hitlist">Shiny Pokedex</a>
    <a href="#shinyweekly" id="nav-shinyweekly">Shiny Weekly</a>
    <a href="#donators" id="nav-donators">Donators</a>
  </div>
  <button id="darkmode-toggle" style="position: absolute; top: 1rem; right: 1.5rem; z-index: 1000; background: var(--card); color: var(--accent); border: 2px solid var(--accent); border-radius: 8px; font-family: 'Press Start 2P', monospace; font-size: 1em; padding: 0.4em 1em; cursor: pointer; box-shadow: 0 2px 10px #000a; transition: background 0.2s, color 0.2s;">
    🌙 Dark Mode
  </button>
  <div id="page-content"></div>
  <!-- Ensure teamshowcase.js is loaded BEFORE showcase.js -->
  <script src="unifiedCard.js"></script>
  <script src="pokemonFamilies.js"></script>
  <script src="pokemonPoints.js"></script>
  <script src="teamshowcase.js"></script>
  <script src="shinydex.js"></script>
  <script src="showcase.js"></script>
  <script src="shinydexsearch.js"></script>
  <!-- THIS LINE ENSURES FAMILY POINTS LOGIC WORKS -->
  <script>
    if (window.buildPokemonPoints) window.buildPokemonPoints();
  </script>
  <!-- FORCE TIER 0/1 SET REBUILD AFTER ALL SCRIPTS LOADED -->
  <script>
    if (window.rebuildTier01Set) window.rebuildTier01Set();
  </script>
  <!-- DONATORS DATA LOADING -->
  <script>
    fetch('donations.json').then(r=>r.json()).then(d=>{
      window.donations = d;
      if (window.teamShowcase && window.assignDonatorTiersToTeam) window.assignDonatorTiersToTeam();
    });
  </script>
  <script src="donators.js"></script>
  <script>
    // Routing: supports #showcase, #showcase-<member>, #hitlist, #shinyweekly, #donators
    function renderPage() {
      let hash = window.location.hash.replace("#", "");
      // Wait for teamShowcase/teamMembers for showcase-related pages
      if (
        (hash.startsWith("showcase") || hash === "" || hash.startsWith("showcase-"))
        && (!window.teamMembers || !window.teamShowcase)
      ) {
        setTimeout(renderPage, 50);
        return;
      }

      document.querySelectorAll('.nav a').forEach(a => {
        let navId = a.getAttribute('href').replace('#','');
        let active = false;
        if (hash.startsWith(navId)) active = true;
        // For default page (no hash), activate showcase
        if (!hash && navId === 'showcase') active = true;
        a.classList.toggle('active', active);
      });

      const content = document.getElementById('page-content');
      if (hash.startsWith("showcase-")) {
        // Split hash for name and sort
        const [namePart, queryPart] = hash.replace("showcase-", "").split("?");
        const memberName = namePart;
        let sortMode = "alphabetical";
        if (queryPart) {
          const m = queryPart.match(/sort=(\w+)/);
          if (m) sortMode = m[1];
        }
        const member = teamMembers.find(m => m.name === memberName);
        if (member) {
          renderMemberShowcase(member, sortMode);
        } else {
          content.innerHTML = "<h1>Member not found.</h1>";
        }
      } else if (hash.startsWith("showcase") || hash === "") {
        // Also check for sort mode in hash
        let sortMode = "alphabetical";
        const m = window.location.hash.match(/sort=(\w+)/);
        if (m) sortMode = m[1];
        content.innerHTML = `
          <div class="showcase-search-controls"></div>
          <div id="showcase-gallery-container"></div>
        `;
        setupShowcaseSearchAndSort(teamMembers, renderShowcaseGallery, sortMode);
      } else if (hash === "hitlist") {
        content.innerHTML = `
          <div id='shiny-dex-container'></div>
        `;
        setTimeout(() => {
          renderShinyDex(shinyDex);
          setTimeout(() => {
            if (typeof setupShinyDexHitlistSearch === 'function') {
              setupShinyDexHitlistSearch(shinyDex, teamShowcase);
            }
          }, 0);
        }, 0);
      } else if (hash === "shinyweekly") {
        content.innerHTML = `
          <div style='font-size:1.4em; margin:2em 0; color:var(--accent); text-align:center;'>soon-to-be</div>
        `;
      } else if (hash === "donators") {
        renderDonators();
      } else {
        content.innerHTML = "<h1>Page not found.</h1>";
      }
    }
    window.addEventListener('hashchange', renderPage);
    document.addEventListener('DOMContentLoaded', renderPage);
  </script>
  <script>
    // Dark mode toggle logic
    const btn = document.getElementById('darkmode-toggle');
    function setDarkMode(on) {
      document.body.classList.toggle('darkmode', on);
      btn.textContent = on ? '☀️ Light Mode' : '🌙 Dark Mode';
      localStorage.setItem('darkmode', on ? '1' : '0');
    }
    btn.onclick = () => setDarkMode(!document.body.classList.contains('darkmode'));
    // On load: check localStorage or system preference
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    setDarkMode(localStorage.getItem('darkmode') === '1' || (!localStorage.getItem('darkmode') && prefersDark));
  </script>
</body>
</html>
